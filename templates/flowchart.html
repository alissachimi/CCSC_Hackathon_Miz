<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElectiveWizard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&family=Roboto:wght@400&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        .class-card {
            position: relative;
            margin-bottom: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            cursor: grab;
        }
    </style>
</head>
<body>
    <div class="background-card">
        <h1>{{major}}</h1>
        <div class="container mt-5">
            <div class="row text-center">
                <div class="col-md-3">
                    <div class="year-title-card">FRESHMAN</div>
                    <div class="row">
                        <div class="col-md-6">Fall</div>
                        <div class="col-md-6">Spring</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="year-title-card">SOPHOMORE</div>
                    <div class="row">
                        <div class="col-md-6">Fall</div>
                        <div class="col-md-6">Spring</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="year-title-card">JUNIOR</div>
                    <div class="row">
                        <div class="col-md-6">Fall</div>
                        <div class="col-md-6">Spring</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="year-title-card">SENIOR</div>
                    <div class="row">
                        <div class="col-md-6">Fall</div>
                        <div class="col-md-6">Spring</div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="freshman-fall" class="year-column class-grid">
                                <div class="class-card filled" id="slot-0-0">Math_101</div>
                                <div class="class-card filled" id="slot-0-1">CS_101</div>
                                <div class="class-card empty" id="slot-0-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-0-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-0-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div id="freshman-spring" class="year-column class-grid">
                                <div class="class-card empty" id="slot-1-0" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-1-1" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-1-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-1-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-1-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="sophomore-fall" class="year-column class-grid">
                                <div class="class-card filled" id="slot-2-0">CS_202</div>
                                <div class="class-card filled" id="slot-2-1">CS_203</div>
                                <div class="class-card empty" id="slot-2-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-2-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-2-4" onclick="cardClicked(this)"></div>
                        </div>
                        <div class="col-md-6">
                            <div id="sophomore-spring" class="year-column class-grid">
                                <div class="class-card empty" id="slot-3-0" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-3-1" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-3-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-3-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-3-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="junior-fall" class="year-column class-grid">
                                <div class="class-card filled" id="slot-4-0">Physics_301</div>
                                <div class="class-card filled" id="slot-4-1">Math_302</div>
                                <div class="class-card empty" id="slot-4-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-4-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-4-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div id="junior-spring" class="year-column class-grid">
                                <div class="class-card empty" id="slot-5-0" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-5-1" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-5-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-5-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-5-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="senior-fall" class="year-column class-grid">
                                <div class="class-card filled" id="slot-6-0">Math_401</div>
                                <div class="class-card filled" id="slot-6-1">CS_402</div>
                                <div class="class-card empty" id="slot-6-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-6-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-6-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div id="senior-spring" class="year-column class-grid">
                                <div class="class-card empty" id="slot-7-0" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-7-1" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-7-2" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-7-3" onclick="cardClicked(this)"></div>
                                <div class="class-card empty" id="slot-7-4" onclick="cardClicked(this)"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="list-card">
                                <div class="list-items-container" id="electiveList">
                                    <!-- Elective items will be dynamically inserted here -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" id="electiveDetails">
                            <div class="info-card">
                                <h4 id="detailTitle"></h4>
                                <div id="detailDescription"></div>
                                <div id="detailAvailability"></div>
                                <div id="detailMinor"></div>
                                <p><strong>Prerequisite:</strong> <span id="detailPrereq"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="minor-button" id="selectCourseButton">Select Course</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const semesters = {
            "semester1": [],
            "semester2": [],
            "semester3": [],
            "semester4": [],
            "semester5": [],
            "semester6": [],
            "semester7": [],
            "semester8": []
        };

        // Initialize Sortable for all year columns
        document.querySelectorAll('.class-grid').forEach(column => {
            new Sortable(column, {
                group: 'shared', // Allow dragging between lists
                animation: 150,
                ghostClass: 'sortable-ghost', // Class for the ghost element
                onEnd: function (evt) {
                    // Ensure cards can't be dragged out of their columns
                    if (!evt.to.classList.contains('class-grid')) {
                        evt.from.appendChild(evt.item); // Revert the drag
                    }
                }
            });
        });

        let selectedCard = null; // Variable to store the clicked card

        function cardClicked(card) {
            selectedCard = card; // Store the clicked card
            $('#myModal').modal('show');
        }

        $('#selectCourseButton').on('click', function () {
            if (selectedCard && selectedCard.classList.contains('empty')) {
                const selectedItem = items.find(item => item.id === $('#detailTitle').data('id'));

                if (selectedItem) {
                    // Update the card content
                    selectedCard.innerHTML = `
                        ${selectedItem.id} 
                    `;

                    // Change the card class from 'empty' to 'filled'
                    selectedCard.classList.remove('empty');
                    selectedCard.classList.add('filled');

                    if(!selectedItem.required){
                        selectedCard.classList.add('elective');
                    }

                    // Optionally, disable further clicks on the card
                    selectedCard.onclick = null;

                    // Close the modal
                    $('#myModal').modal('hide');
                }
            }
        });
        const items = [
            {
                id: 'CS_101',
                name: 'Introduction to Programming',
                description: 'A foundational course covering basic programming concepts, syntax, and problem-solving using Python.',
                availability: 0.95,
                minor: 'Yes',
                prereq: 'None',
                required:true
            },
            {
                id: 'CS_201',
                name: 'Data Structures and Algorithms',
                description: 'Explores fundamental data structures (arrays, linked lists, trees, graphs) and algorithms (sorting, searching) with a focus on implementation and analysis.',
                availability: 0.8,
                minor: 'Yes',
                prereq: 'Introduction to Programming',
                required:false
            },
            {
                id: 'CS_301',
                name: 'Object-Oriented Programming',
                description: 'Introduces object-oriented principles (encapsulation, inheritance, polymorphism) using Java or C++.',
                availability: 0.75,
                minor: 'Yes',
                prereq: 'Introduction to Programming',
                required:true
            },
            {
                id: 'CS_350',
                name: 'Database Systems',
                description: 'Covers database design, SQL, and database management systems, including relational and NoSQL databases.',
                availability: 0.6,
                minor: 'Yes',
                prereq: 'Data Structures and Algorithms',
                required:false
            },
            {
                id: 'CS_330',
                name: 'Computer Networks',
                description: 'Explores the principles of computer networking, including protocols, network architectures, and security.',
                availability: 0.5,
                minor: 'Yes',
                prereq: 'Data Structures and Algorithms',
                required:false
            },
            {
                id: 'CS_401',
                name: 'Operating Systems',
                description: 'Covers the concepts and design of operating systems, including process management, memory management, and file systems.',
                availability: 0.4,
                minor: 'Yes',
                prereq: 'Data Structures and Algorithms',
                required:false
            },
            {
                id: 'CS_450',
                name: 'Software Engineering',
                description: 'Introduces software development methodologies, project management, and software testing.',
                availability: 0.7,
                minor: 'Yes',
                prereq: 'Object-Oriented Programming',
                required:false
            },
            {
                id: 'CS_470',
                name: 'Artificial Intelligence',
                description: 'An introduction to AI concepts, including machine learning, neural networks, and natural language processing.',
                availability: 0.3,
                minor: 'Yes',
                prereq: 'Data Structures and Algorithms, Linear Algebra',
                required:false
            },
            {
                id: 'CS_250',
                name: 'Web Development',
                description: 'Covers front-end and back-end web development using HTML, CSS, JavaScript, and a server-side framework.',
                availability: 0.85,
                minor: 'Yes',
                prereq: 'Introduction to Programming',
                required:false
            },
            {
                id: 'CS_430',
                name: 'Cybersecurity Fundamentals',
                description: 'An introductory class covering basic cybersecurity concepts, threats, and mitigation techniques.',
                availability: 0.65,
                minor: 'Yes',
                prereq: 'Computer Networks',
                required:false
            }
        ];

        function loadElectives() {
            const electiveList = $('#electiveList');
            electiveList.empty();

            items.forEach(item => {
                const red = Math.round(200 + (55 * (1 - item.availability)));
                const green = Math.round(200 + (55 * item.availability));
                const color = `rgba(${red}, ${green}, 200, 0.5)`;
                const glowColor = `rgba(${red}, ${green}, 200)`; // Slightly more opaque for the glow

                const card = `
                    <div class="list-item" data-id="${item.id}" style="box-shadow: 0 0 5px 2px ${glowColor};">
                        <h5>${item.id}</h5>
                        <h4>${item.name}</h4>
                    </div>
                `;
                electiveList.append(card);
            });
        }

        function showElectiveDetails(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                // Update title
                $('#detailTitle').text(item.name).data('id', item.id);

                // Update description
                $('#detailDescription').html(`
                    <div class="description-card">
                        <p>${item.description}</p>
                    </div>
                `);

                // Update availability with dynamic color
                const availabilityPercent = Math.round(item.availability * 100);
                const progressColor = availabilityPercent < 50 ? '#ff4444' : availabilityPercent < 75 ? '#ffbb33' : '#4caf50';
                $('#detailAvailability').html(`
                    <div class="availability-container">
                        <div class="availability-label">Availability: ${availabilityPercent}%</div>
                        <div class="availability-bar">
                            <div class="availability-progress" style="width: ${availabilityPercent}%; background-color: ${progressColor}"></div>
                        </div>
                    </div>
                `);

                // Update minors list as buttons with popups
                const minors = item.minor === 'Yes' ? ['Computer Science', 'Data Science', 'Cybersecurity'] : ['None'];
                const minorsHtml = minors.map(minor => `
                    <button class="minor-button" data-minor="${minor}">${minor}</button>
                `).join('');
                $('#detailMinor').html(`
                    <div class="minors-list">
                        <h5>Counts Towards Minors:</h5>
                        <div class="minor-buttons">${minorsHtml}</div>
                        <div id="minorPopup" class="minor-popup"></div>
                    </div>
                `);

                // Add click handlers for minor buttons
                $('.minor-button').on('click', function () {
                    const minor = $(this).data('minor');
                    const additionalClasses = getAdditionalClasses(minor);
                    $('#minorPopup').html(`
                        <div class="popup-content">
                            <h6>Additional Required Classes for ${minor}:</h6>
                            ${additionalClasses}
                        </div>
                    `).fadeIn(200);
                });

                // Close popup when clicking outside
                $(document).on('click', function (e) {
                    if (!$(e.target).closest('.minor-button, #minorPopup').length) {
                        $('#minorPopup').fadeOut(200);
                    }
                });

                // Update prerequisite
                $('#detailPrereq').text(item.prereq);
            }
        }

        // Helper function to get additional classes for minors
        function getAdditionalClasses(minor) {
            const additionalClasses = {
                'Computer Science': `
                    <div class="class-status-taken">CS 101 (Taken)</div>
                    <div class="class-status-planned">CS 201 (Planned)</div>
                    <div class="class-status-needed">CS 301 (Need)</div>
                `,
                'Data Science': `
                    <div class="class-status-taken">DS 101 (Taken)</div>
                    <div class="class-status-needed">DS 201 (Need)</div>
                    <div class="class-status-needed">MATH 101 (Need)</div>
                `,
                'Cybersecurity': `
                    <div class="class-status-taken">CS 101 (Taken)</div>
                    <div class="class-status-planned">CS 430 (Planned)</div>
                    <div class="class-status-needed">MATH 101 (Need)</div>
                `
            };
            return additionalClasses[minor] || 'None';
        }

        // Auto-load the first item's details when the modal opens
        $('#myModal').on('shown.bs.modal', function () {
            if (items.length > 0) {
                const firstItem = items[0];
                showElectiveDetails(firstItem.id);
            }
        });

        // Load electives and set up click handlers
        $(document).ready(function () {
            loadElectives();
            $('#electiveList').on('click', '.list-item', function () {
                const id = $(this).data('id');
                showElectiveDetails(id);
            });
        });
    </script>
</body>
</html>